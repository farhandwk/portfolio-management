<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Management</title>
    <style>
        :root {
            --primary-color: #007bff;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; max-width: 900px; margin: 2em auto; background-color: var(--light-gray); color: var(--dark-gray); }
        h1, h2 { text-align: center; }
        form { background: #fff; padding: 2em; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2em; }
        div { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="url"], textarea { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 4px; font-size: 16px; color: white; }
        button[type="submit"] { width: 100%; background-color: var(--primary-color); }
        button[type="submit"]:hover { background-color: #0056b3; }
        #portfolio-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .portfolio-item { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        .portfolio-item img { max-width: 100%; border-radius: 4px; }
        .portfolio-item-actions { margin-top: 10px; display: flex; gap: 10px; }
        .edit-btn { background-color: var(--warning-color); color: #212529;}
        .delete-btn { background-color: var(--danger-color); }
        #cancel-edit-btn { background-color: #6c757d; width: 100%; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <h1>Portfolio Management</h1>

    <form id="portfolio-form">
        <h2 id="form-title">Add New Portfolio</h2>
        <input type="hidden" id="portfolio-id" name="id">
        
        <div><label for="title">Title:</label><input type="text" id="title" name="title" required></div>
        <div><label for="description">Description:</label><textarea id="description" name="description" rows="4"></textarea></div>
        <div><label for="projectUrl">Project URL:</label><input type="url" id="projectUrl" name="projectUrl" placeholder="https://proyek-live-demo.com"></div>
        <div><label for="githubUrl">GitHub URL:</label><input type="url" id="githubUrl" name="githubUrl" placeholder="https://github.com/user/repo"></div>
        <div><label for="tags">Tags (pisahkan dengan koma):</label><input type="text" id="tags" name="tags"></div>
        <div><label for="image">Image (kosongkan jika tidak ingin mengubah):</label><input type="file" id="image" name="image"></div>
        
        <button type="submit" id="submit-btn">Add Portfolio</button>
        <button type="button" id="cancel-edit-btn">Cancel Edit</button>
    </form>

    <hr>
    <h2>Existing Portfolios</h2>
    <div id="portfolio-list">
        <p>Loading...</p>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/api/portfolio';
        const portfolioList = document.getElementById('portfolio-list');
        const portfolioForm = document.getElementById('portfolio-form');
        const formTitle = document.getElementById('form-title');
        const submitBtn = document.getElementById('submit-btn');
        const cancelBtn = document.getElementById('cancel-edit-btn');
        const portfolioIdInput = document.getElementById('portfolio-id');

        // --- FUNGSI UTAMA ---

        // 1. Mengambil dan Menampilkan Semua Portfolio (GET)
        async function fetchAndRenderPortfolios() {
            try {
                const response = await fetch(API_URL);
                const portfolios = await response.json();
                
                portfolioList.innerHTML = ''; // Kosongkan daftar sebelum diisi ulang
                if (portfolios.length === 0) {
                    portfolioList.innerHTML = '<p>No portfolio items yet.</p>';
                    return;
                }

                portfolios.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'portfolio-item';
                    itemElement.innerHTML = `
                        <h3>${item.title}</h3>
                        ${item.imageUrl ? `<img src="http://localhost:3001${item.imageUrl}" alt="${item.title}">` : ''}
                        <p>${item.description || ''}</p>
                        <p><strong>Tags:</strong> ${item.tags || 'N/A'}</p>
                        <p><a href="${item.projectUrl}" target="_blank">Project Link</a> | <a href="${item.githubUrl}" target="_blank">GitHub Link</a></p>
                        <div class="portfolio-item-actions">
                            <button class="edit-btn" onclick="prepareEditForm(${item.id})">Edit</button>
                            <button class="delete-btn" onclick="deletePortfolio(${item.id})">Delete</button>
                        </div>
                    `;
                    portfolioList.appendChild(itemElement);
                });
            } catch (error) {
                console.error('Error fetching portfolios:', error);
                portfolioList.innerHTML = '<p>Failed to load portfolios.</p>';
            }
        }

        // 2. Menangani Submit Form (POST atau PUT)
        portfolioForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Mencegah form dari refresh halaman
            
            const formData = new FormData(portfolioForm);
            const id = portfolioIdInput.value;
            const url = id ? `${API_URL}/${id}` : API_URL;
            const method = id ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, {
                    method: method,
                    body: formData // FormData otomatis mengatur header Content-Type menjadi multipart/form-data
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Something went wrong');
                }

                alert(`Portfolio successfully ${id ? 'updated' : 'added'}!`);
                resetForm();
                fetchAndRenderPortfolios(); // Muat ulang daftar
            } catch (error) {
                console.error(`Error submitting form:`, error);
                alert(`Error: ${error.message}`);
            }
        });

        // 3. Menyiapkan Form untuk Mode Edit
        async function prepareEditForm(id) {
            try {
                const response = await fetch(`${API_URL}/${id}`);
                const item = await response.json();

                // Isi form dengan data yang ada
                portfolioIdInput.value = item.id;
                document.getElementById('title').value = item.title;
                document.getElementById('description').value = item.description;
                document.getElementById('projectUrl').value = item.projectUrl;
                document.getElementById('githubUrl').value = item.githubUrl;
                document.getElementById('tags').value = item.tags;

                // Ubah tampilan form ke mode edit
                formTitle.textContent = 'Edit Portfolio';
                submitBtn.textContent = 'Update Portfolio';
                cancelBtn.style.display = 'block';

                // Scroll ke atas agar form terlihat
                window.scrollTo(0, 0);
            } catch (error) {
                console.error('Error preparing edit form:', error);
            }
        }

        // 4. Menghapus Portfolio (DELETE)
        async function deletePortfolio(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                try {
                    const response = await fetch(`${API_URL}/${id}`, {
                        method: 'DELETE'
                    });

                    if (!response.ok) {
                        throw new Error('Failed to delete');
                    }
                    
                    alert('Portfolio deleted successfully!');
                    fetchAndRenderPortfolios(); // Muat ulang daftar
                } catch (error) {
                    console.error('Error deleting portfolio:', error);
                }
            }
        }

        // --- FUNGSI BANTUAN ---

        // Mengembalikan form ke mode "Add New"
        function resetForm() {
            portfolioForm.reset();
            portfolioIdInput.value = '';
            formTitle.textContent = 'Add New Portfolio';
            submitBtn.textContent = 'Add Portfolio';
            cancelBtn.style.display = 'none';
        }

        // Event listener untuk tombol cancel
        cancelBtn.addEventListener('click', resetForm);
        
        // --- INISIALISASI ---
        
        // Panggil fungsi ini saat halaman pertama kali dimuat
        document.addEventListener('DOMContentLoaded', fetchAndRenderPortfolios);
    </script>
</body>
</html>